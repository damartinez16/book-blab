<%- include('../partials/header') %>
  <div class="show-page">
    <div>Title: <%= book.title %>
    </div>
    <div>Author: <%= book.author %>
    </div>
    <div>Rating: <%= book.genre %>
    </div>
  </div>
  <br><br>
  <h2>Reviews</h2>

  <% if (user) { %>
    <div class="review-field">
      <div class="review-box">
        <form id="add-review-form" method="POST" action="/books/<%= book._id %>/comments">
          <label>Review:</label>
          <textarea name="content"></textarea>
      </div>
      <div class="rate-box"><label>Rating:</label>
        <select name="rating">
          <option value="1">1</option>
          <option value="2">2</option>
          <option value="3">3</option>
          <option value="4">4</option>
          <option value="5">5</option>
        </select>
      </div>
      <div class="review-button"><input type="submit" value="Add Review">
        </form>
        <% } %>
      </div>
    </div>

    <% if (book.comments.length) { %>
      <table>
        <thead>
          <tr>
            <th>User</th>
            <th>Date</th>
            <th>Review</th>
            <th>Rating</th>
            <th></th>
          </tr>
        </thead>
        <br>
        <tbody>
          <% let total=0 %>
            <% book.comments.forEach(function(c) { %>
              <% total +=c.rating %>
                <tr>
                  <td class="review-user"><img src="<%= c.userAvatar %>">&nbsp;<div class="username">
                      <%= c.userName %>
                    </div>
                  </td>
                  <td>
                    <%= c.createdAt.toLocaleDateString() %>
                  </td>
                  <td>
                    <%= c.content %>
                  </td>
                  <td>
                    <%= c.rating %>
                  </td>
                  <td>
                    <% if (user && user._id.equals(c.user)) { %>
                      <form action="/comments/<%= c._id %>?_method=DELETE" method="POST">
                        <button type="submit">X</button>
                      </form>
                      <a href="/comments/<%=c._id%>/edit">Edit</a>
                      <% } %>
                  </td>
                </tr>
                <% }); %>
                  <tr>
                    <td colspan="3"></td>
                    <td><strong>
                        <%= (total / book.comments.length).toFixed(1) %>
                      </strong></td>
                  </tr>
        </tbody>
      </table>
      <% } else { %>
        <h5>No Reviews Yet</h5>
        <% } %>

          <%- include('../partials/footer') %>